# –î–µ–ø–ª–æ–π —Ñ—É–Ω–∫—Ü–∏–π –¥–µ–ø–ª–æ–π–µ—Ä–∞ –≤ Yandex Cloud

## –ü—Ä–æ–±–ª–µ–º–∞
–í—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–µ–ø–ª–æ–π–µ—Ä–∞ —Å–µ–π—á–∞—Å —Ä–∞–±–æ—Ç–∞—é—Ç —á–µ—Ä–µ–∑ `poehali.dev`. –ù—É–∂–Ω–æ –∑–∞–¥–µ–ø–ª–æ–∏—Ç—å –∏—Ö –≤ —Ç–≤–æ–π —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π Yandex Cloud.

## –†–µ—à–µ–Ω–∏–µ

### ‚ö° –í–∞—Ä–∏–∞–Ω—Ç 1: –ß–µ—Ä–µ–∑ deploy-functions (–°–ê–ú–´–ô –ü–†–û–°–¢–û–ô)

**–í–∞–∂–Ω–æ:** –ò—Å–ø–æ–ª—å–∑—É–π `deploy-functions` —á–µ—Ä–µ–∑ `poehali.dev` **–û–î–ò–ù –†–ê–ó**, —á—Ç–æ–±—ã –∑–∞–¥–µ–ø–ª–æ–∏—Ç—å –≤—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–µ–ø–ª–æ–π–µ—Ä–∞ –≤ —Ç–≤–æ–π Yandex Cloud.

1. **–î–æ–±–∞–≤—å –∫–æ–Ω—Ñ–∏–≥ –¥–µ–ø–ª–æ—è –¥–ª—è —Å–∞–º–æ–≥–æ –¥–µ–ø–ª–æ–π–µ—Ä–∞:**
   - –û—Ç–∫—Ä–æ–π –¥–µ–ø–ª–æ–π–µ—Ä: http://localhost:5173/deploy
   - –ù–∞–∂–º–∏ "–ù–æ–≤—ã–π –∫–æ–Ω—Ñ–∏–≥"
   - –ó–∞–ø–æ–ª–Ω–∏:
     - **–ù–∞–∑–≤–∞–Ω–∏–µ**: `deployer` (–∏–ª–∏ –ª—é–±–æ–µ –¥—Ä—É–≥–æ–µ)
     - **–î–æ–º–µ–Ω**: `localhost` (–Ω–µ –≤–∞–∂–Ω–æ –¥–ª—è –¥–µ–ø–ª–æ—è —Ñ—É–Ω–∫—Ü–∏–π)
     - **GitHub —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π**: `—Ç–≤–æ–π-username/telegram-psychologist-bot-main-2` (–∏–ª–∏ –ø–æ–ª–Ω—ã–π –ø—É—Ç—å –∫ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—é –¥–µ–ø–ª–æ–π–µ—Ä–∞)
   - –°–æ—Ö—Ä–∞–Ω–∏ –∫–æ–Ω—Ñ–∏–≥

2. **–ó–∞–¥–µ–ø–ª–æ–π —Ñ—É–Ω–∫—Ü–∏–∏ –¥–µ–ø–ª–æ–π–µ—Ä–∞:**
   - –ù–∞–π–¥–∏ —Å–æ–∑–¥–∞–Ω–Ω—ã–π –∫–æ–Ω—Ñ–∏–≥ –≤ —Å–ø–∏—Å–∫–µ
   - –ù–∞–∂–º–∏ **"–î–µ–ø–ª–æ–π backend-—Ñ—É–Ω–∫—Ü–∏–π"**
   - –î–æ–∂–¥–∏—Å—å –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è (–º–æ–∂–µ—Ç –∑–∞–Ω—è—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –º–∏–Ω—É—Ç)
   - –í—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∏–∑ –ø–∞–ø–∫–∏ `backend/` –±—É–¥—É—Ç –∑–∞–¥–µ–ø–ª–æ–µ–Ω—ã –≤ —Ç–≤–æ–π Yandex Cloud
   - `func2url.json` –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–∏—Ç—Å—è —Å –Ω–æ–≤—ã–º–∏ URL

3. **–û–±–Ω–æ–≤–∏ frontend:**
   - –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏ dev —Å–µ—Ä–≤–µ—Ä: –æ—Å—Ç–∞–Ω–æ–≤–∏ (Ctrl+C) –∏ –∑–∞–ø—É—Å—Ç–∏ —Å–Ω–æ–≤–∞ `npm run dev`
   - –ò–ª–∏ –ø—Ä–æ—Å—Ç–æ –æ–±–Ω–æ–≤–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—É - –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–æ–¥—Ç—è–Ω—É—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
   - –¢–µ–ø–µ—Ä—å –≤—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ –±—É–¥—É—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–≤–æ–∏ URL –∏–∑ Yandex Cloud

4. **–ü—Ä–æ–≤–µ—Ä—å:**
   - –û—Ç–∫—Ä–æ–π `backend/func2url.json` - –≤—Å–µ URL –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –≤–∏–¥–∞ `https://functions.yandexcloud.net/...`
   - –ü–æ–ø—Ä–æ–±—É–π —Å–æ–∑–¥–∞—Ç—å VM –∏–ª–∏ –≤—ã–ø–æ–ª–Ω–∏—Ç—å –¥—Ä—É–≥–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ - –¥–æ–ª–∂–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å —á–µ—Ä–µ–∑ —Ç–≤–æ–∏ —Ñ—É–Ω–∫—Ü–∏–∏

**–ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ –¥–µ–ø–ª–æ–π–µ—Ä –ø–æ–ª–Ω–æ—Å—Ç—å—é –ø–µ—Ä–µ–π–¥—ë—Ç –Ω–∞ —Ç–≤–æ—é –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—É!** üéâ

### –í–∞—Ä–∏–∞–Ω—Ç 2: –í—Ä—É—á–Ω—É—é —á–µ—Ä–µ–∑ Yandex Cloud Console

–î–ª—è –∫–∞–∂–¥–æ–π —Ñ—É–Ω–∫—Ü–∏–∏ –≤ –ø–∞–ø–∫–µ `backend/`:

1. –û—Ç–∫—Ä–æ–π [Yandex Cloud Functions](https://console.cloud.yandex.ru/functions)
2. –ù–∞–∂–º–∏ "–°–æ–∑–¥–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏—é"
3. –ù–∞—Å—Ç—Ä–æ–π–∫–∏:
   - **–ò–º—è**: –∏–º—è –ø–∞–ø–∫–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `vm-list`, `deploy-config`)
   - **–û–ø–∏—Å–∞–Ω–∏–µ**: –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ
   - **–°—Ä–µ–¥–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è**: Python 3.11
   - **–¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞**: `index.handler`
   - **–¢–∞–π–º–∞—É—Ç**: 30-60 —Å–µ–∫—É–Ω–¥ (–¥–ª—è `deploy-functions` –∏ `deploy-long` - 120 —Å–µ–∫—É–Ω–¥)
   - **–ü–∞–º—è—Ç—å**: 128 MB (–¥–ª—è `deploy-functions` –∏ `deploy-long` - 256 MB)

4. **–ö–æ–¥ —Ñ—É–Ω–∫—Ü–∏–∏:**
   - –°–∫–æ–ø–∏—Ä—É–π —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ `backend/[–∏–º—è-—Ñ—É–Ω–∫—Ü–∏–∏]/index.py`
   - –í—Å—Ç–∞–≤—å –≤ —Ä–µ–¥–∞–∫—Ç–æ—Ä –∫–æ–¥–∞ —Ñ—É–Ω–∫—Ü–∏–∏

5. **–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:**
   - –ï—Å–ª–∏ –µ—Å—Ç—å `requirements.txt`, –¥–æ–±–∞–≤—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –≤ —Ä–∞–∑–¥–µ–ª "–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏"
   - –ò–ª–∏ —Å–æ–∑–¥–∞–π —Ñ–∞–π–ª `requirements.txt` –≤ –∫–æ–¥–µ —Ñ—É–Ω–∫—Ü–∏–∏

6. **–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:**
   - `DATABASE_URL` - —Å—Ç—Ä–æ–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ PostgreSQL
   - `GITHUB_TOKEN` - GitHub Personal Access Token (–¥–ª—è —Ñ—É–Ω–∫—Ü–∏–π, —Ä–∞–±–æ—Ç–∞—é—â–∏—Ö —Å GitHub)
   - `YANDEX_CLOUD_TOKEN` - OAuth —Ç–æ–∫–µ–Ω Yandex Cloud (–¥–ª—è —Ñ—É–Ω–∫—Ü–∏–π, —Ä–∞–±–æ—Ç–∞—é—â–∏—Ö —Å YC API)
   - `MAIN_DB_SCHEMA` - —Å—Ö–µ–º–∞ –ë–î (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `public`)

7. **–°–æ–∑–¥–∞–π –≤–µ—Ä—Å–∏—é —Ñ—É–Ω–∫—Ü–∏–∏**

8. **–°–∫–æ–ø–∏—Ä—É–π URL —Ñ—É–Ω–∫—Ü–∏–∏** (–±—É–¥–µ—Ç –≤–∏–¥–∞ `https://functions.yandexcloud.net/...`)

9. **–û–±–Ω–æ–≤–∏ `backend/func2url.json`:**
   ```json
   {
     "vm-list": "https://functions.yandexcloud.net/–¢–í–û–ô_ID",
     ...
   }
   ```

### –í–∞—Ä–∏–∞–Ω—Ç 3: –ß–µ—Ä–µ–∑ Yandex Cloud CLI (yc)

–ï—Å–ª–∏ —É —Ç–µ–±—è —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω `yc` CLI:

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∏ yc CLI –µ—Å–ª–∏ –Ω–µ—Ç
# https://cloud.yandex.ru/docs/cli/quickstart

# –ê–≤—Ç–æ—Ä–∏–∑—É–π—Å—è
yc init

# –î–ª—è –∫–∞–∂–¥–æ–π —Ñ—É–Ω–∫—Ü–∏–∏:
cd backend/vm-list
yc serverless function create --name vm-list
yc serverless function version create \
  --function-name vm-list \
  --runtime python311 \
  --entrypoint index.handler \
  --source-path . \
  --memory 128m \
  --execution-timeout 30s \
  --environment DATABASE_URL=...,GITHUB_TOKEN=...
```

## –°–ø–∏—Å–æ–∫ —Ñ—É–Ω–∫—Ü–∏–π –¥–ª—è –¥–µ–ø–ª–æ—è

### –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–µ–ø–ª–æ–π–µ—Ä–∞:
- ‚úÖ `deploy-config` - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥–∞–º–∏ –¥–µ–ø–ª–æ—è
- ‚úÖ `deploy-long` - –¥–µ–ø–ª–æ–π —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞ –Ω–∞ VM (–¥–æ–ª–≥–∏–π –ø—Ä–æ—Ü–µ—Å—Å)
- ‚úÖ `deploy-functions` - –¥–µ–ø–ª–æ–π backend —Ñ—É–Ω–∫—Ü–∏–π
- ‚úÖ `deploy-status` - —Å—Ç–∞—Ç—É—Å –¥–µ–ø–ª–æ—è
- ‚úÖ `vm-setup` - —Å–æ–∑–¥–∞–Ω–∏–µ VM
- ‚úÖ `vm-list` - —Å–ø–∏—Å–æ–∫ VM (GET/DELETE)
- ‚úÖ `vm-ssh-key` - –ø–æ–ª—É—á–µ–Ω–∏–µ SSH –∫–ª—é—á–∞ VM
- ‚úÖ `yc-sync` - —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è VM —Å Yandex Cloud
- ‚úÖ `migrate` - –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π –ë–î

### –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:
- `quiz-api` - API –¥–ª—è –∫–≤–∏–∑–æ–≤ (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—à—å)
- `metrika-goals` - —Å–æ–∑–¥–∞–Ω–∏–µ —Ü–µ–ª–µ–π –≤ –Ø–Ω–¥–µ–∫—Å.–ú–µ—Ç—Ä–∏–∫–µ (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—à—å)
- `setup-webhook` - –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ webhook (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—à—å)
- `deploy` - —Å—Ç–∞—Ä–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–µ–ø–ª–æ—è (–º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ –Ω—É–∂–Ω–∞)

## –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –¥–ª—è –∫–∞–∂–¥–æ–π —Ñ—É–Ω–∫—Ü–∏–∏

| –§—É–Ω–∫—Ü–∏—è | DATABASE_URL | GITHUB_TOKEN | YANDEX_CLOUD_TOKEN | –î—Ä—É–≥–∏–µ |
|---------|--------------|--------------|-------------------|---------|
| `deploy-config` | ‚úÖ | ‚ùå | ‚ùå | - |
| `deploy-long` | ‚úÖ | ‚úÖ | ‚ùå | - |
| `deploy-functions` | ‚ùå | ‚úÖ | ‚úÖ | - |
| `deploy-status` | ‚úÖ | ‚ùå | ‚ùå | - |
| `vm-setup` | ‚úÖ | ‚ùå | ‚úÖ | - |
| `vm-list` | ‚úÖ | ‚ùå | ‚ùå (–¥–ª—è DELETE –Ω—É–∂–µ–Ω) | - |
| `vm-ssh-key` | ‚úÖ | ‚ùå | ‚ùå | - |
| `yc-sync` | ‚úÖ | ‚ùå | ‚úÖ | - |
| `migrate` | ‚úÖ | ‚úÖ | ‚ùå | - |

## –ü–æ—Å–ª–µ –¥–µ–ø–ª–æ—è

1. **–û–±–Ω–æ–≤–∏ `func2url.json`** —Å –Ω–æ–≤—ã–º–∏ URL
2. **–ó–∞–∫–æ–º–º–∏—Ç—å –∏ –∑–∞–ø—É—à—å –∏–∑–º–µ–Ω–µ–Ω–∏—è** –≤ GitHub —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –¥–µ–ø–ª–æ–π–µ—Ä–∞
3. **–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏ dev —Å–µ—Ä–≤–µ—Ä** –∏–ª–∏ –ø–µ—Ä–µ—Å–æ–±–µ—Ä–∏ –ø—Ä–æ–µ–∫—Ç
4. **–ü—Ä–æ–≤–µ—Ä—å —Ä–∞–±–æ—Ç—É** - –≤—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–æ–ª–∂–Ω—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–≤–æ–∏ URL

## –í–∞–∂–Ω–æ

- –ü–æ—Å–ª–µ –¥–µ–ø–ª–æ—è –≤—Å–µ—Ö —Ñ—É–Ω–∫—Ü–∏–π –¥–µ–ø–ª–æ–π–µ—Ä–∞, `deploy-functions` –±—É–¥–µ—Ç –æ–±–Ω–æ–≤–ª—è—Ç—å `func2url.json` –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
- –ù–æ —Å–∞–º `deploy-functions` –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∑–∞–¥–µ–ø–ª–æ–µ–Ω –≤—Ä—É—á–Ω—É—é –∏–ª–∏ —á–µ—Ä–µ–∑ poehali.dev –æ–¥–∏–Ω —Ä–∞–∑
- –£–±–µ–¥–∏—Å—å —á—Ç–æ –≤—Å–µ —Å–µ–∫—Ä–µ—Ç—ã –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –ø–µ—Ä–µ–¥ –¥–µ–ø–ª–æ–µ–º —Ñ—É–Ω–∫—Ü–∏–π
