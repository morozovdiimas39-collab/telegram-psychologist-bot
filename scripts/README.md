# Автоматический деплой в Yandex Cloud

## Быстрый старт

### 1. Создать инфраструктуру

Запусти скрипт на своём компьютере (нужен Python 3.7+):

```bash
cd scripts
pip3 install requests
python3 setup-yandex-cloud.py
```

Скрипт автоматически:
- ✅ Создаст VM в Yandex Cloud
- ✅ Установит Docker, nginx, PostgreSQL
- ✅ Настроит webhook-сервер для приёма деплоев
- ✅ Выдаст IP адрес и команды для настройки

### 2. Добавить секреты

После создания VM скрипт выдаст данные вида:

```
VM IP адрес: 51.250.12.34
Webhook URL: http://51.250.12.34:9000/deploy
```

Добавь эти секреты в poehali.dev (виджет выше):

- `VM_IP_ADDRESS` = `51.250.12.34`
- `VM_WEBHOOK_URL` = `http://51.250.12.34:9000/deploy`

### 3. Деплой проектов

Теперь можешь деплоить через форму:
1. Открой `/deploy` в своём проекте
2. Заполни GitHub URL, название, домен
3. Нажми "Развернуть проект"

Webhook автоматически:
- Склонирует репозиторий
- Создаст базу данных
- Соберёт Docker контейнер
- Настроит nginx + SSL
- Запустит проект

### 4. Настройка DNS

Для каждого домена добавь A-запись:

```
example.ru → 51.250.12.34
```

SSL сертификат выпустится автоматически через Let's Encrypt.

## Стоимость

- **VM**: ~2000₽/мес (2 CPU, 4GB RAM, 30GB SSD)
- **Трафик**: ~300₽/мес при среднем трафике

**Итого**: ~2500₽/мес на все проекты (вместо 10000₽+ за отдельные VM)

## Ручной деплой

Если webhook не работает, можно деплоить вручную:

```bash
ssh ubuntu@51.250.12.34
python3 /opt/deploy-project.py \
  --github https://github.com/user/repo \
  --name myproject \
  --domain example.ru \
  --secrets '["OPENAI_KEY=sk-xxx"]'
```

## Что дальше

- Добавь мониторинг (Grafana + Prometheus)
- Настрой бэкапы PostgreSQL
- Добавь CI/CD через GitHub Actions
